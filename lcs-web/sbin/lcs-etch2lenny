#!/bin/bash
#Couleurs
COLTITRE="\033[1;35m"          # Rose
COLCMD="\033[1;37m"            # Blanc
COLQUESTION="\033[1;32m"       # Vert



if  ! grep -q "4.0" /etc/debian_version;  then
        if egrep -q "^5.0" /etc/debian_version; then
                echo "Votre serveur est deja en version Debian Lenny"
                exit 0
        else
                echo "Votre serveur n'est pas en version Debian Etch."
                echo "Operation annulee !"
                exit 1
        fi
fi

echo -e "$COLTITRE"
echo "******************************"
echo "* Migration Etch vers Lenny  *"
echo "******************************"
echo -e "$COLQUESTION\c"
echo "Voulez vous continuez (O/n) ? "
echo -e "$COLCMD\c"
read REPLY
if [ "$REPLY" != "O" ] &&  [ "$REPLY" != "o" ] && [ -n $REPLY ]; then
        echo "Pas de migration !"
        exit 1
fi

echo -e "$COLTITRE"
echo "Migration LCS de Debian Etch vers Lenny"
echo -e "$COLCMD\c"

echo "1. Changement du source list"
sed -i.etch s/etch/lenny/g /etc/apt/sources.list
sed -i.bak s/"-caen.fr\/lenny"/"-caen.fr\/etch"/g /etc/apt/sources.list
sed -i s/"etch Lcs main"/"etch LcsXP main"/g  /etc/apt/sources.list

echo "2. Upgrade de la distribution : Fournir les reponses par defaut."
apt-get update
apt-get dist-upgrade -y

echo "3. Mise a jour des droits sur le repertoires MAILDIR"
for MAILDIR in `find /home -name Maildir`
do
        echo "$MAILDIR"
        chgrp -R lcs-users $MAILDIR
done

echo "4. Mise en place de lcs-sysinfo en remplacement de lcs-phpsysinfo"
apt-get install -y --force-yes lcs-sysinfo

echo -e "$COLTITRE"
echo "FIN !"
echo -e "$COLCMD\c"
