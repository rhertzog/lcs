[(#REM) Menu depliant au survol
adapte du menu de Mathieu (Marcmat) Marcillau
pour compatibilite avec le menu-dom

]	
[(#SET{titre_menu,[(#CONFIG{tispipskelet_conf/titre_menu})]})]
[(#SET{plus,[(#CONFIG{tispipskelet_conf/img_menu})_xx.png]})] 
[(#SET{minus,[(#CONFIG{tispipskelet_conf/img_menu})_yy.png]})]
[(#SET{vide,[(#CONFIG{tispipskelet_conf/img_menu})_zz.png]})]
<div id="menu_mm" class="rubriques" style="padding-bottom:5px">
  <!-- exclusion des rubriques avec le mot-clé "pas-au-menu" et de ses sous-rubriques -->
  <BOUCLE_exclure_rub(RUBRIQUES){titre_mot=_exclure_menu_}{doublons}>
  <BOUCLE_exclure_ssrub(RUBRIQUES){id_parent}{doublons}></BOUCLE_exclure_ssrub>   
</BOUCLE_exclure_rub>

  <B_secteurs>
<h3 class="menu-titre">#GET{titre_menu,Navigation}</h3>
  <ul class="rubriques menunavdom" style="margin-top:0">
		[(#CONFIG{tispipskelet_conf/lien_accueil_menu}|oui)
			<li class="secteur">
				<a href="spip.php?page=sommaire"[ (#ENV{page}|=={accueil}|oui)class="on"] title="Aller &agrave; la page d'accueil">
					[(#CONFIG{tispipskelet_conf/strong_menu}|?{<strong>Accueil</strong>,Accueil})]
				</a>
			</li>
		]
      <BOUCLE_secteurs(RUBRIQUES) {racine} {par titre} {doublons}>
          <li class="secteur[ (#EXPOSE)]">
    <a href="#URL_RUBRIQUE"[ class="(#EXPOSE)"] title="[(#INTRODUCTION|couper{40})]">[(#TITRE|supprimer_numero)]</a>
[(#REM)
                <!-- affichage des articles des secteurs s'il y en a -->
					<INCLURE{fond=noisettes/inc-menu_articles}{id_rubrique}>
]


          <!-- affichage des sous-rubriques -->
          <B_rubriques>
              <ul class="rubriques subMenu[ (#EXPOSE|?{open_at_load})]">
                  <BOUCLE_rubriques(RUBRIQUES) {id_parent} {par num titre, titre}{doublons}>
                  <li class="secteur[ (#EXPOSE)]">
              <a href="#URL_RUBRIQUE"[ class="(#EXPOSE)"] title="[(#INTRODUCTION|couper{40})]">[(#TITRE|supprimer_numero)]</a>
[(#REM)
                <!-- affichage des articles -->
					<INCLURE{fond=noisettes/inc-menu_articles}{id_rubrique}>
]
                  <!-- on refait tourner la boucle pour les sous-sous...-rubriques -->
                  <BOUCLE_sous_rubriques(BOUCLE_rubriques)></BOUCLE_sous_rubriques>
                  </li>
                  </BOUCLE_rubriques>
              </ul>
          </B_rubriques>
</li>
      </BOUCLE_secteurs>
      </ul>
      </B_secteurs>
</div>
<script type="text/javascript">
<!--
(function($){
  $(document).ready(function(){

      /*
       * Menu depliant de navigation
       */
       /*Ajout menu-dom*/
	    // On selectionne tous les items de liste" 
		$(".menunavdom li").each( function () {
		//on recherche si les rubiques listees comportent des sous-rubriques
			if($(this).children("ul").find("li").length !=0) {
				// si oui, on place l'image plus.gif devant le lien et on ajoute la classe toggleSubMenu
				$(this).prepend("<img src='[(#CHEMIN{img_pack/menu-dom/[(#GET{plus,folder_xx.png})]})]' alt='D&eacute;plier' class='bouton' />");
				$(this).addClass("toggleSubMenu");
			} else {
				//sinon on place une image transparente
		 		$(this).prepend("<img src='[(#CHEMIN{img_pack/menu-dom/[(#GET{vide,folder_zz.png})]})]' alt='' class='vielle_fille' />");
			}
	   }) ;
		$('ul.open_at_load').parent('li').addClass("open").children('img').attr({ src: "[(#CHEMIN{img_pack/menu-dom/[(#GET{minus,folder_yy.png})]})]", alt: "Plier" });
       /*Fin ajout menu-dom*/
       
      $('ul.menunavdom li:not(.on) ul').hide();
      $('ul.menunavdom li a, ul.menunavdom li img').hover(function(){
          var me=this;
          var time=400;
          // un temps plus long pour refermer !
          if ($(me).parent().find('>ul').is(':visible')) {
              time=1200;
          }

          $(me).addClass('hop');
          setTimeout(function(){
              // verifier que la souris n'est pas deja partie !
              if ($(me).hasClass("hop")) {
                  var parent = $(me).parent();
                  // verifier que ce n'est pas une liste exposee
                  if (!$(parent).hasClass('on')) {
                      // fermer les ul
                      var ul = $(parent).find('>ul');
                      if ($(ul).is(':visible')) {
                          $(ul).find('li:not(.on) ul').hide();
						       /*Ajout menu-dom*/
						 				$(me).parent('li.toggleSubMenu:not(.on)').find('img:not(.vielle_fille)').attr({ src: "[(#CHEMIN{img_pack/menu-dom/[(#GET{plus,folder_xx.png})]})]", alt: "D&eacute;plier" });
						       /*Fin ajout menu-dom*/
                          $(ul).slideUp('fast');
                      // ou ouvrir le premier
                      } else {
                          $(ul).slideDown('fast');
						       /*Ajout menu-dom*/
						 				$(me).parents('li.toggleSubMenu').children('img').attr({ src: "[(#CHEMIN{img_pack/menu-dom/[(#GET{minus,folder_yy.png})]})]", alt: "Plier" });
						       /*Fin ajout menu-dom*/
                     }
                  }
              }
          }, time);
      },function(){
          $(this).removeClass('hop');
      });


  });
})(jQuery);

// -->
</script>

