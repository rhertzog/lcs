<?php
function formulaire($Nom="",$Prenom="",$Email="",$Sujet="",$Message="") {

$version=" #SPIP_VERSION";
$message_intro='<p class="ctctTice_intro">Ce site est propulsé par <a href="http://www.spip.net" title="<:site_realise_avec_spip:> #SPIP_VERSION"><acronym title="Système de Publication pour Internet Partagé">SPIP</acronym>'. $version.'</a>. ';
$message_intro.='Le squelette est une réalisation de l\'<a href="http://www.ac-caen.fr/tice/index.php?page=rhdev" title="">Equipe TICE de l\'Académie de CAEN</a>°(<span style="vertical-align: 4px; font-size: 70%">D</span><span style="vertical-align: -3px; font-size :70%">O</span><span style="vertical-align: 4px; font-size: 70%">M</span>)°</p>';
$message_intro.='<p class="ctctTice_intro">Cette page est destinée à vos remarques et/ou suggestions sur l\'aspect technique de ce site.';
$message_intro.=' Pour tout message relatif au contenu, veuillez contacter l\'<a href="spip.php?auteur3" title="Contacter l\'administrateur">administrateur</a> de ce site</p>';
$message_intro.='<p class="ctctTice_intro"> Veuillez remplir tous les champs de ce formulaire.</p>';
echo $message_intro;
?>
<form action="<?php echo $PHP_SELF ?>" method="post">
  
<div class="table">
	<div class="caption">Formulaire de contact</div>
	<div class="tbody">
		<div class="tr">
			<div class="td" style="width:40%">Votre nom :</div>
			<div class="td end"><input type="text" name="Nom" size="30" value="<?php echo trim(htmlentities($Nom)) ?>" /></div>
		</div>
		<div class="tr">
			<div class="td" style="width:40%">Votre prénom :</div>
			<div class="td end"><input type="text" name="Prenom" value="<?php echo trim(htmlentities($Prenom)) ?>" size="30" /></div>
		</div>
		<div class="tr">
			<div class="td" style="width:40%">Votre E-mail :</div>
			<div class="td end"><input type="text" name="Email" value="<?php echo trim(htmlentities($Email)) ?>" size="30" /></div>
		</div>
		<div class="tr">
			<div class="td" style="width:40%">Motif de votre message :</div>
			<div class="td end">
			    <input type="radio" name="Sujet" value="Renseignement" <?php if ($Sujet=='Renseignement') { echo $s; } ?> size="30" />Renseignement<br />
				<input type="radio" name="Sujet" value="Probleme Technique" <?php if ($Sujet=='Probleme_Technique') { echo $s; } ?> size="30" />Problème technique<br />
				<input type="radio" name="Sujet" value="Avis sur le site" <?php if ($Sujet=='Avis sur le site') { echo $s; } ?> size="30" />Votre avis sur le site<br />
				<input type="radio" name="Sujet" value="Autre sujet" <?php if ($Sujet=='Autre sujet') { echo $s; } ?> size="30" />Autre<br />
			</div>
		</div>
		<div class="tr">
			<div class="td" style="width:40%">Votre message :</div>
			<div class="td end">
				<textarea name="Message" rows="10" cols=" " style="width:100%">
					<? if (ereg("[]%~#`$&|}{^[><]",$Message)) {
						echo "Certains caractères utilisés sont interdits";$erreur=1; }
					else {
						echo trim($Message); 
					} ?>
				</textarea>
			</div>
		</div>
		<div class="tr">
			<div class="td" style="width:1px"></div>
			<div class="td end"><input type="submit" name="Submit" value="Envoi" alt="Envoi" title="Envoi de votre message" /></div>
		</div>
	</div>
</div>

<?
}
if(!isset($Nom)) { 
	formulaire();
}
else {
	$vNom=trim(htmlentities($_POST["Nom"]));
	$vPrenom=trim(htmlentities($_POST["Prenom"]));
	$vMessage=trim(htmlentities($_POST["Message"]));
	$vEmail=trim(htmlentities($_POST["Email"]));
	$vSujet=trim(htmlentities($_POST["Sujet"]));
	$destinataire='dlepaisant@ac-caen.fr[,(#CONFIG{lcs_skel_conf/mel_admin})]';
	$titre="Contact LCS";
	$message="Provenance : $HTTP_REFERER\n";
	$message.="Adresse IP : $REMOTE_ADDR,\n";
	$message.="Navigateur : $HTTP_USER_AGENT\n";
	$message.="Nom : $vNom\n";
	$message.="Prenom : $vPrenom\n";
	$message.="E-mail : $vEmail\nMotif : ";
	$message.= "$vSujet\n";
	$message.="Message : $vMessage\n";
	if (empty($vNom)) {
		echo "<p class='red'>Vous n'avez pas donné votre nom</p>";
		$erreur=1;
	}
	if (empty($vPrenom)) {
		echo "<p class='red'>Vous n'avez pas donné votre prénom</p>";
		$erreur=1;
	}
	if (empty($Email)) {
		echo "<p class='red'>Vous n'avez pas donné votre adresse électronique ... comment pourrais-je vous répondre ?</p>";
		$erreur=1;
	}
	if (empty($Sujet)) {
		echo "<p class='red'>Vous n'avez pas choisi le motif de votre message</p>";
		$erreur=1;
	}
	if (!eregi("^[0-9a-z]([-_.]?[0-9a-z])*@[0-9a-z]([-_.]?[0-9a-z])*\\.[a-z]{2,4}$",$vEmail) && ($erreur<>1)){
		echo "<p class='red'>L'adresse e-mail n'est pas correcte :</p>";
		$erreur=1;
	}
	if (empty($Message)) {
		echo "<p class='red'>Vous n'avez pas composé de message ! Distrait(e) ?</p>";
		$erreur=1;
	}
	if ($erreur==1) {
		formulaire($Nom,$Prenom,$Email,$Sujet,$Message);
	}
	else {
		mail($destinataire,$titre,$message,"From: $vEmail") ;
		echo '<p class="vi4">Votre message a bien été envoyé au webmestre du site.</p>';
		echo '<p class="vi4">Je vous répondrai dès que possible.</p>';
		echo '<ul><li><br />Nom : <span class="valeur">' . $vNom . "</span>\n";
		echo '<li><br />Prenom : <span class="valeur">' . $vPrenom. "</span></li>\n";
		echo '<li><br />E-mail : <span class="valeur">' . $vEmail. "</span></li>\n";
		echo '<li><br />Motif de votre message : <span class="valeur">' . $vSujet. "</span></li>\n";
		echo '<li><br />Message : <br /><span class="valeur">' . $vMessage."</span></li></ul>\n";


	}
}
?>
</form>
