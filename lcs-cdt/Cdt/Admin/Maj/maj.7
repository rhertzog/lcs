#!/bin/bash
echo " Ceci est le script de mise à jour de 0.61 à 1.0 du plugin Cdt";
mv /usr/share/lcs/Plugins/Cdt/Includes/config.inc.php /usr/share/lcs/Plugins/Cdt/Includes/config.inc.php.tmp1
cat /usr/share/lcs/Plugins/Cdt/Includes/config.inc.php.tmp1 | sed -e "s/0.61/1.0/g" > /usr/share/lcs/Plugins/Cdt/Includes/config.inc.php.tmp2
cat /usr/share/lcs/Plugins/Cdt/Includes/config.inc.php.tmp2 | sed '/^$VER_PLUG/a\$FLAG_ABSENCE=0;' > /usr/share/lcs/Plugins/Cdt/Includes/config.inc.php.tmp1
cat /usr/share/lcs/Plugins/Cdt/Includes/config.inc.php.tmp1 | sed '/^$FLAG_RESTRICT/d;' > /usr/share/lcs/Plugins/Cdt/Includes/config.inc.php.tmp2
grin=`pwgen -1`
cat /usr/share/lcs/Plugins/Cdt/Includes/config.inc.php.tmp2 | sed '/^$FLAG_ABSENCE/a\$Grain="#xxx#";' > /usr/share/lcs/Plugins/Cdt/Includes/config.inc.php.tmp1
cat /usr/share/lcs/Plugins/Cdt/Includes/config.inc.php.tmp1 | sed -e "s/#xxx#/$grin/g" > /usr/share/lcs/Plugins/Cdt/Includes/config.inc.php.tmp2
cat /usr/share/lcs/Plugins/Cdt/Includes/config.inc.php.tmp2 | tr -d '\r' | sed '/^$/d' > /usr/share/lcs/Plugins/Cdt/Includes/config.inc.php
rm /usr/share/lcs/Plugins/Cdt/Includes/config.inc.php.tmp1
rm /usr/share/lcs/Plugins/Cdt/Includes/config.inc.php.tmp2
echo "Suppression des fichiers obsoletes";
cd /usr/share/lcs/Plugins/Cdt/images
rm -f File0044.bmp bt_ul.png form.png img.png new012.gif dd.png gg.png souligne.gif bt_br.png gras.gif italique.gif trombone.gif bt_ol.png File0044.bmp hyper.png 
cd /usr/share/lcs/Plugins/Cdt/Includes
rm -f texte1 texte2 texte3 texte4 texte5 page.html
cd /usr/share/lcs/Plugins/Cdt/scripts
rm -f calendrier.php
