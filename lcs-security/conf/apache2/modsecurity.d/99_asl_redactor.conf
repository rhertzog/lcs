# Created by Michael Shinn of Atomicorp
# (http://www.prometheus-group.com)
# Copyright 2009-2012 by Michael Shinn and Atomicorp, all rights
# reserved.
# Redistribution is strictly prohibited in any form, including whole or in
# part.
#
# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS 
# AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE 
# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE 
# ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE 
# LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR 
# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF 
# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS 
# INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN 
# CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) 
# ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF 
# THE POSSIBILITY OF SUCH DAMAGE.
#

# Do not edit this file!
# This file is generated and changes will be overwritten.
#
# If you need to make changes to the rules, please follow the procedure here:
# http://www.atomicorp.com/wiki/index.php/Mod_security

#LoadModule sed_module modules/mod_sed.so

<IfModule mod_sed.c>

<Directory "/">
AddOutputFilter Sed html
#Packed javascript hidden iframes
#<script>eval(function(p,a,c,k,e,d).*style|display|http|src|write|width|height|if|none</script>
#javascript packer
OutputSed "/<[Ss][Cc][Rr][Ii][Pp][Tt].*[Ee][Vv][Aa][Ll].*[Pp],[Aa],[Cc],[Kk],[Ee],[Dd].*[Nn][Oo][Nn][Ee].*[Ss][Cc][Rr][Ii][Pp][Tt]>/ {"
OutputSed "y/ABCDEFGHIJKLMNOPQRSTUVWXYZ/abcdefghijklmnopqrstuvwxyz/;"
OutputSed "s/  //g;"
OutputSed "s/\"//g;"
OutputSed "s/\'//g;" 
OutputSed "s/ =/=/g;"
OutputSed "s/= /=/g;"
OutputSed "s/< /</g;"
OutputSed "s/ >/>/g;"
OutputSed " s/<script.*eval.*p,a,c,k,e,d.*style|display|http|src|write|width|height|if|none.*script>//g"
OutputSed "    b alldone"
OutputSed "}"
OutputSed "/<.*[Ss][Cc][Rr][Ii][Pp][Tt].*[Ee][Vv][Aa][Ll].*[Pp],[Aa],[Cc],[Kk],[Ee],[Dd].*[Nn][Oo][Nn][Ee].*[Ss][Cc][Rr][Ii][Pp][Tt].*>/ {"
OutputSed "y/ABCDEFGHIJKLMNOPQRSTUVWXYZ/abcdefghijklmnopqrstuvwxyz/;"
OutputSed "s/  //g;"
OutputSed "s/\"//g;"
OutputSed "s/\'//g;" 
OutputSed "s/ =/=/g;"
OutputSed "s/= /=/g;"
OutputSed "s/< /</g;"
OutputSed "s/ >/>/g;"
OutputSed " s/<.*script.*eval.*p,a,c,k,e,d.*style|display|http|src|write|width|height|if|none.*script.*>//g"
OutputSed "    b alldone"
OutputSed "}"


OutputSed "/<*[Ii][Ff][Rr][Aa][Mm][Ee].*[Ii][Ff][Rr][Aa][Mm][Ee]*>/ {"
OutputSed "s/[Ii][Ff][Rr][Aa][Mm][Ee]/iframe/g;"
OutputSed "s/[S][Tt][Yy][Ll][Ee]/style/g;"
OutputSed "s/[Dd][Ii][ss][Pp][Ll][Aa][Yy]/display/g;"
OutputSed "s/[Hh][Ee][Ii][Gg][Hh][Tt]/height/g;"
OutputSed "s/[Ww][Ii][Dd][Tt][Hh]/width/g;"
OutputSed "s/:[Nn][Oo][Nn][Ee]/:none/g;"
OutputSed "s/  //g;"
OutputSed "s/\"//g;"
OutputSed "s/\'//g;" 
OutputSed "s/ =/=/g;"
OutputSed "s/= /=/g;"
OutputSed "s/< /</g;"
OutputSed "s/ >/>/g;"

OutputSed "s/<\!--.*-->//g;"

OutputSed "/style=display:none/ {"
OutputSed " s/<*iframe.*style=display:none.*[ \.]width=[0-4][ \;>].*iframe*>//g"
OutputSed "    b alldone"
OutputSed " }"

OutputSed "/style=display:none/ {"
OutputSed " s/<*iframe.*style=display:none.*[ \.]height=[0-4][ \;>].*iframe*>//g"
OutputSed "    b alldone"
OutputSed " }"


OutputSed "/width=[0-4][ a-z>\;]/ {"
OutputSed " s/<*iframe.*src.*[ \.]width=[0-4][ \;>].*iframe*>//g"
OutputSed "    b alldone"
OutputSed " }"


OutputSed "/height=[0-4][ a-z>\;]/ {"
OutputSed " s/<*iframe.*src.*[ \.]height=[0-4][ \;>].*iframe*>//g"
OutputSed "    b alldone"
OutputSed " }"

OutputSed "}"

OutputSed "/<.*[Ii][Ff][Rr][Aa][Mm][Ee].*[Ii][Ff][Rr][Aa][Mm].*>/ {"
OutputSed "s/[Ii][Ff][Rr][Aa][Mm][Ee]/iframe/g;"
OutputSed "s/[S][Tt][Yy][Ll][Ee]/style/g;"
OutputSed "s/[Dd][Ii][ss][Pp][Ll][Aa][Yy]/display/g;"
OutputSed "s/[Hh][Ee][Ii][Gg][Hh][Tt]/height/g;"
OutputSed "s/[Ww][Ii][Dd][Tt][Hh]/width/g;"
OutputSed "s/:[Nn][Oo][Nn][Ee]/:none/g;"
OutputSed "s/  //g;"
OutputSed "s/\"//g;"
OutputSed "s/\'//g;" 
OutputSed "s/ =/=/g;"
OutputSed "s/= /=/g;"
OutputSed "s/< /</g;"
OutputSed "s/ >/>/g;"

OutputSed "s/<\!--.*-->//g;"

OutputSed "/style=display:none/ {"
OutputSed " s/<*iframe.*style=display:none.*[ \.]width=[0-4][ \;>].*iframe*>//g"
OutputSed "    b alldone"
OutputSed " }"

OutputSed "/style=display:none/ {"
OutputSed " s/<*iframe.*style=display:none.*[ \.]height=[0-4][ \;>].*iframe*>//g"
OutputSed "    b alldone"
OutputSed " }"


OutputSed "/[ \.]width=[0-4][ a-z>\;]/ {"
OutputSed " s/<*iframe.*src.*[ \.]width=[0-4][ \;>].*iframe*>//g"
OutputSed "    b alldone"
OutputSed " }"


OutputSed "/ height=[0-4][ a-z>\;]/ {"
OutputSed " s/<*iframe.*src.*[ \.]height=[0-4][ \;>].*iframe*>//g"
OutputSed "    b alldone"
OutputSed " }"

OutputSed "}"

#encoded iframes - strip them out
OutputSed "/%3.*%69%66%72%61%6D.*%69%66%72%61%6D.*%3/ {"
OutputSed " s/%3.*%69%66%72%61%6D.*%69%66%72%61%6D.*%3//g"
OutputSed "    b alldone"
OutputSed "}"
OutputSed "/%3%69%66%72%61%6D.*%69%66%72%61%6D%3/ {"
OutputSed " s/%3%69%66%72%61%6D.*%69%66%72%61%6D%3//g"
OutputSed "    b alldone"
OutputSed "}"

#javascript onload frame attacks
#frame onload="if (!this.src){ this.src='http://url'; this.height=1; this.width=1;}"
OutputSed "/<*[Ff][Rr][Aa][Mm][Ee].*[Oo][Nn][Ll][Oo][Aa][Dd]*>/ {"
OutputSed "y/ABCDEFGHIJKLMNOPQRSTUVWXYZ/abcdefghijklmnopqrstuvwxyz/;"
OutputSed "s/  //g;"
#OutputSed "s/\"//g;"
#OutputSed "s/\'//g;" 
OutputSed "s/ =/=/g;"
OutputSed "s/= /=/g;"
OutputSed "s/< /</g;"
OutputSed "s/ >/>/g;"

OutputSed "s/<\!--.*-->//g;"

OutputSed "/width=[0-4]\;/ {"
OutputSed " s/<*frame.*onload.*width=[0-4]\;.*>//g"
OutputSed "    b alldone"
OutputSed " }"

OutputSed "/height=[0-4]\;/ {"
OutputSed " s/frame.*onload.*height=[0-4]\;.*>//g"
OutputSed "    b alldone"
OutputSed " }"

OutputSed "}"
OutputSed "/<*.[Ff][Rr][Aa][Mm][Ee].*[Oo][Nn][Ll][Oo][Aa][Dd].*>/ {"
OutputSed "y/ABCDEFGHIJKLMNOPQRSTUVWXYZ/abcdefghijklmnopqrstuvwxyz/;"
OutputSed "s/  //g;"
#OutputSed "s/\"//g;"
#OutputSed "s/\'//g;" 
OutputSed "s/ =/=/g;"
OutputSed "s/= /=/g;"
OutputSed "s/< /</g;"
OutputSed "s/ >/>/g;"

OutputSed "s/<\!--.*-->//g;"

OutputSed "/width=[0-4]\;/ {"
OutputSed " s/<*frame.*onload.*width=[0-4]\;.*>//g"
OutputSed "    b alldone"
OutputSed " }"

OutputSed "/height=[0-4]\;/ {"
OutputSed " s/<*frame.*onload.*height=[0-4]\;.*>//g"
OutputSed "    b alldone"
OutputSed " }"

OutputSed "}"

#encoded <.*iframe.*style.*hidden.*iframe.*>
#OutputSed "/%3.*%69%66%72%61%6D.*%69%66%72%61%6D.*%3/ {"
#OutputSed " s/%3.*%69%66%72%61%6D.*%73%74%79%6C%65.*68%69%64%64%65%6E.*%69%66%72%61%6D.*%3//g"
#OutputSed "    b alldone"
#OutputSed "}"

#encoded <iframe.*style.*hidden.*iframe>
#OutputSed "/%3%69%66%72%61%6D.*%69%66%72%61%6D%3/ {"
#OutputSed " s/%3%69%66%72%61%6D.*%73%74%79%6C%65.*68%69%64%64%65%6E.*%69%66%72%61%6D%3//g"
#OutputSed "    b alldone"
#OutputSed "}"

#Invisible spam rules
#<div class="dnn_dnnContent" style="margin-left: -1500px;"><a href="http://otimizacao-de-websites.com">otimizaÃƒÂ§ÃƒÂ£o de sites</a> <a href="http://desentupidorasanehidro.com.br">desentupidora</a> <a href="http://www.graficavendahoje.com.br">grafica</a> <a href="http://www.deeplaser.com.br">clinica de estetica</a> <a href="http://asacompanhantessp.com.br">acompanhantes sao paulo</a> <a href="http://pactotransportes.com.br">transportadora</a> <a href="http://www.mtksistemas.com.br">relogio de ponto</a> <a href="http://www.dentistaespecialista.com.br">dentista</a></div>
#OutputSed "/<*[Dd][Ii][Vv]*>.*<*[Ss][Tt][Yy][Ll][Ee]*>.*<*[Ss][Tt][Yy][Ll][Ee]*>.*<*Dd][Ii][Vv]*>/ {"
#NOTENOTENOTE!  Maybe lowercase is a bad idea, might break CSS, so this rule might need to be upper lower
#OutputSed "y/ABCDEFGHIJKLMNOPQRSTUVWXYZ/abcdefghijklmnopqrstuvwxyz/;"
#NOTENOTENOTE!  Maybe lowercase is a bad idea, might break CSS, so this rule might need to be upper lower
#OutputSed "s/  //g;"
##OutputSed "s/\"//g;"
##OutputSed "s/\'//g;" 
#OutputSed "s/ =/=/g;"
#OutputSed "s/= /=/g;"
#OutputSed "s/< /</g;"
#OutputSed "s/ >/>/g;"

#OutputSed "s/<\!--.*-->//g;"

#strip spacing from before and after px
#OutputSed "s/[Pp][Xx] /px/g;"
#OutputSed "s/[Pp][Xx];/px;/g;"
#OutputSed "s/[0-9][Pp][Xx];/[0-9]px;/g;"
#OutputSed "s/[0-9] px/[0-9]px/g;"

#OutputSed "/-[0-9]+px\;/ {"
#OutputSed " s/<*div*-[0-9]+px;*div*>//g"
#OutputSed "    b alldone"
#OutputSed " }"

#OutputSed "}"
#
#OutputSed "/<.*[Dd][Ii][Vv].*>.*<.*[Ss][Tt][Yy][Ll][Ee].*>.*<.*[Ss][Tt][Yy][Ll][Ee].*>.*<.*Dd][Ii][Vv].*>/ {"
#NOTENOTENOTE!  Maybe lowercase is a bad idea, might break CSS, so this rule might need to be upper lower
#OutputSed "y/ABCDEFGHIJKLMNOPQRSTUVWXYZ/abcdefghijklmnopqrstuvwxyz/;"
#NOTENOTENOTE!  Maybe lowercase is a bad idea, might break CSS, so this rule might need to be upper lower
#OutputSed "s/  //g;"
#OutputSed "s/\"//g;"
#OutputSed "s/\'//g;" 
#OutputSed "s/ =/=/g;"
#OutputSed "s/= /=/g;"
#OutputSed "s/< /</g;"
#OutputSed "s/ >/>/g;"

#OutputSed "s/<\!--.*-->//g;"

#strip spacing from before and after px
#OutputSed "s/[Pp][Xx] /px/g;"
#OutputSed "s/[Pp][Xx];/px;/g;"
#OutputSed "s/[0-9][Pp][Xx];/[0-9]px;/g;"
#OutputSed "s/[0-9] px/[0-9]px/g;"

#OutputSed "/-[0-9]+px\;/ {"
#OutputSed " s/<*div*-[0-9]+px;*div*>//g"
#OutputSed "    b alldone"
#OutputSed " }"

#this.src="http://badsite.tld/url"; this.height=0; this.width=0;}

#ALL DONE
OutputSed ": alldone"

 </Directory> 
</IfModule>

<LocationMatch /fckdialog.html>
RemoveOutputFilter Sed html
</LocationMatch>
